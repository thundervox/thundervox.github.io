# 2026年2月4日 - DlgZoom.cpp / .h

よくある表示倍率変更ダイアログですね。
スピンコントロールに現在の倍率を表示してOKボタンを押すと指定倍率が反映されるという。

## DlgZoom.h

特に書くことはありませんので軽く解説。

* pParent: コンストラクタの引数 (親ウィンドウのポインタ)
* m_pView: pParentと同じアドレスを共有しているようです。

* IDD_ZOOM: ダイアログ (リソース識別子 - VisualScript.rc)
* CDlgZoom: 表示倍率 (ダイアログ、 IDC_ZOOMに渡されます)
* m_strZoom: 表示倍率 (内部処理)

## DlgZoom.cpp

コンストラクタで表示倍率の取得後に IntToCString (メモリ操作絡みがあるので解析は後ほど)を使いダイアログで表示できる形式へ変換します。

## BOOL CDlgZoom::OnInitDialog()

``` cpp
BOOL CDlgZoom::OnInitDialog() 
// 中略
m_strZoom = IntToCString ( m_pView->GetZoom ( ) ) + "%";
```

IntToCString (strext.cpp, .h) は整数を CString 型 (文字列) へ変換します。

``` cpp
CString LongToCString (long lNum, int iRadix = 10, BOOL bComma = FALSE);
```

引数は、
 
* long lNum: 文字列にする数値
* int iRadix: 基数 (省略時: 10 進数)
* BOOL bComma: カンマ区切り表記 (省略時: FALSE)

返値は CString 型の文字列です。通常、 iRadix と bComma は省略時します。そもそも、あまり使われていないので引数ですが。


## BOOL CDlgZoom::OnOK()
これは、OKボタン押し下げ後、 SetZoom で倍率変更をして再描画ですね。 

``` cpp
BOOL CDlgZoom::OnOK() 
// 中略
m_pView->SetZoom ( __minmax ( 50, 200, atoi ( m_strZoom ) ) );
```

__minmax は theilen.cpp にあるインライン展開の関数です。上限値と下限値、そして指定値を与えることで値の範囲を制限します。

``` cpp
inline int __minmax (int _low, int _hi, int _val)
{ 
	return (_val <= _low ? _low : (_val >= _hi ? _hi : _val));
}
```

三項演算子なのでちょっと読みづらいですが、括弧の評価順序とコロンの対応関係に注意すればわかると思います。

引数は、
* int _low: 下限値 (最小倍率は 50 倍)
* int _hi: 上限値 (最大倍率は 200 倍)
* int _val: 判定用の指定値 (変更予定の倍率)

返値は指定値において、
1. 上限値以上ならば _hi を、
2. 下限値以下ならば _low を、
3. どちらでもない範囲内の値ならば _val を、
返します。

* atoi は C の標準関数です。この場合は表示で使った文字列型を整数へ変換して SetZoom に渡しています。変数の型が違うのでこの処理が必要です。ただし、現在ではセキュリティ上の理由により廃止されていますので std:stoi (C++ 11 以降) などに書き換える必要があります (IntToCString などの内部処理でも類似箇所があります)。

GetZoom は view.h に、 SetZoom は view.cpp にあり、どちらも m_zoom 変数(view.h, document.h) を操作します。


## 補足

* strext.cpp: CStringDelete. CStringInsert はPage2Stageにおいて未使用(デッドコード)のようです。
